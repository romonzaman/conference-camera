<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üé• Conference Camera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'spin-slow': 'spin 1s linear infinite',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">üé• Conference Camera</h1>
            <p class="text-white/80 text-sm md:text-base">Smart video switching based on active speaker detection</p>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- Status Bar -->
            <div id="status" class="px-4 py-3 border-b border-gray-200">
                <div class="flex items-center justify-center">
                    <div id="statusIndicator" class="w-3 h-3 rounded-full bg-gray-400 mr-3"></div>
                    <span id="statusText" class="text-sm font-medium text-gray-600">Disconnected - Click Start to begin</span>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-50 border-l-4 border-red-400 p-4 mx-4 mt-4 rounded">
                <div class="flex">
                    <div class="ml-3">
                        <p class="text-sm text-red-700"></p>
                    </div>
                </div>
            </div>

            <!-- Main Layout: Video + Controls -->
            <div class="flex flex-col lg:flex-row">
                <!-- Video Section (Left) - Hidden when disconnected -->
                <div id="videoSection" class="lg:w-1/2 p-4 hidden">
                    <div class="relative">
                        <div class="aspect-video bg-black rounded-xl overflow-hidden shadow-lg relative">
                            <video id="localVideo" class="w-full h-full object-cover" autoplay playsinline muted></video>
                            
                            <!-- Video Overlay with Name and Channel -->
                            <div id="videoOverlay" class="absolute top-4 left-4 right-4 bg-black/30 backdrop-blur-sm rounded-lg px-4 py-2 text-white">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-8 h-8 bg-gradient-to-r from-indigo-500/80 to-purple-600/80 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                            <span id="overlayInitial">U</span>
                                        </div>
                                        <div id="overlayName" class="font-bold text-sm text-white drop-shadow-lg">Unknown</div>
                                    </div>
                                    <div id="overlayChannel" class="text-sm font-bold text-white drop-shadow-lg">#N/A</div>
                                </div>
                            </div>

                            <!-- Overlay Control Buttons -->
                            <button id="muteBtn" class="absolute bottom-4 left-4 w-12 h-12 bg-black/50 hover:bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110 hidden">
                                <span class="text-xl">üîä</span>
                            </button>

                            <button id="stopBtn" class="absolute bottom-4 right-4 w-12 h-12 bg-red-500/80 hover:bg-red-600/80 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110 hidden">
                                <span class="text-xl">‚èπÔ∏è</span>
                            </button>
                        </div>
                        
                        <!-- Audio Visualizer -->
                        <div class="mt-4">
                            <div class="text-xs text-gray-500 mb-2">Audio Level</div>
                            <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div id="audioLevel" class="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 rounded-full transition-all duration-100" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Controls Section (Right) - Full width when disconnected -->
                <div id="controlsSection" class="lg:w-1/2 p-4 lg:pl-0">
                    <div class="space-y-6">
                        <!-- User Info Form -->
                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-200">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                                <span class="text-indigo-600 mr-2">üë§</span>
                                Your Information
                            </h3>
                            <div id="muteStateIndicator" class="hidden text-xs text-indigo-600 mb-2 flex items-center">
                                <span class="mr-1">üíæ</span>
                                <span>Preferences restored from previous session</span>
                            </div>
                            <div id="saveIndicator" class="hidden text-xs text-green-600 mb-2 flex items-center">
                                <span class="mr-1">‚úì</span>
                                <span>Preferences saved</span>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label for="userName" class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
                                    <input type="text" id="userName" placeholder="Enter your name" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm transition-colors">
                                </div>
                                <div>
                                    <label for="channelSelect" class="block text-sm font-medium text-gray-700 mb-2">Channel</label>
                                    <select id="channelSelect" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm transition-colors">
                                        <option value="">Select Channel</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Control Buttons -->
                        <div class="space-y-3">
                            <button id="startBtn" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                                <span class="text-xl">üöÄ</span>
                                <span>Join Conference</span>
                            </button>
                        </div>

                        <!-- Instructions -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">How it works:</h3>
                            <ul class="space-y-2 text-sm text-gray-600">
                                <li class="flex items-start space-x-2">
                                    <span class="text-green-500 font-bold">‚úì</span>
                                    <span>Click "Join Conference" to begin streaming</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <span class="text-green-500 font-bold">‚úì</span>
                                    <span>Grant camera and microphone permissions</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <span class="text-green-500 font-bold">‚úì</span>
                                    <span>Use "Mute" button to toggle microphone</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <span class="text-green-500 font-bold">‚úì</span>
                                    <span>Speak to see audio level visualization</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <span class="text-green-500 font-bold">‚úì</span>
                                    <span>Server switches to active speaker automatically</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <span class="text-green-500 font-bold">‚úì</span>
                                    <span>Multiple devices can connect simultaneously</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Quick Links -->
                        <div class="text-center space-y-2">
                            <a href="/viewer" class="inline-flex items-center space-x-2 text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                                <span>üëÅÔ∏è</span>
                                <span>View Server Output</span>
                            </a>
                            <div class="text-xs text-gray-500">
                                <button onclick="clearUserPreferences()" class="text-gray-400 hover:text-gray-600 underline">
                                    Clear saved preferences
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let pc = null;
        let localStream = null;
        let clientId = null;
        let audioContext = null;
        let analyser = null;
        let animationId = null;
        let audioTrack = null;
        let isMuted = false;
        let userName = '';
        let channelNumber = '';

        // DOM elements
        const statusEl = document.getElementById('status');
        const statusTextEl = document.getElementById('statusText');
        const errorMessageEl = document.getElementById('errorMessage');
        const localVideoEl = document.getElementById('localVideo');
        const audioLevelEl = document.getElementById('audioLevel');
        const startBtn = document.getElementById('startBtn');
        const muteBtn = document.getElementById('muteBtn');
        const stopBtn = document.getElementById('stopBtn');
        const userNameInput = document.getElementById('userName');
        const channelSelect = document.getElementById('channelSelect');
        const videoSection = document.getElementById('videoSection');
        const controlsSection = document.getElementById('controlsSection');

        // Show/hide video section and adjust layout
        function showVideoSection() {
            videoSection.classList.remove('hidden');
            controlsSection.classList.remove('lg:w-1/2');
            controlsSection.classList.add('lg:w-1/2');
        }

        function hideVideoSection() {
            videoSection.classList.add('hidden');
            controlsSection.classList.remove('lg:w-1/2');
            controlsSection.classList.add('w-full');
        }

        // Show/hide control buttons
        function showControlButtons() {
            muteBtn.classList.remove('hidden');
            stopBtn.classList.remove('hidden');
        }

        function hideControlButtons() {
            muteBtn.classList.add('hidden');
            stopBtn.classList.add('hidden');
        }

        // Show/hide start button
        function showStartButton() {
            startBtn.classList.remove('hidden');
        }

        function hideStartButton() {
            startBtn.classList.add('hidden');
        }

        // Show/hide information form
        function showInfoForm() {
            const infoForm = document.querySelector('.bg-gradient-to-r.from-indigo-50.to-purple-50');
            if (infoForm) {
                infoForm.classList.remove('hidden');
            }
        }

        function hideInfoForm() {
            const infoForm = document.querySelector('.bg-gradient-to-r.from-indigo-50.to-purple-50');
            if (infoForm) {
                infoForm.classList.add('hidden');
            }
        }

        // Update video overlay with user info
        function updateVideoOverlay() {
            const overlayInitial = document.getElementById('overlayInitial');
            const overlayName = document.getElementById('overlayName');
            const overlayChannel = document.getElementById('overlayChannel');
            
            if (overlayInitial && overlayName && overlayChannel) {
                const name = userNameInput.value.trim() || 'Unknown';
                const channel = channelSelect.value || 'N/A';
                
                overlayInitial.textContent = name.charAt(0).toUpperCase();
                overlayName.textContent = name;
                overlayChannel.textContent = `#${channel}`;
            }
        }

        // Update button text
        function updateButtonText(connected) {
            const buttonIcon = startBtn.querySelector('span:first-child');
            const buttonText = startBtn.querySelector('span:last-child');
            
            if (connected) {
                buttonIcon.textContent = 'üìπ';
                buttonText.textContent = 'Start Camera';
            } else {
                buttonIcon.textContent = 'üöÄ';
                buttonText.textContent = 'Join Conference';
            }
        }

        // Update status display
        function updateStatus(status, text) {
            const statusIndicator = document.getElementById('statusIndicator');
            statusTextEl.textContent = text;
            
            // Update status indicator color
            statusIndicator.className = 'w-3 h-3 rounded-full mr-3';
            if (status === 'connected') {
                statusIndicator.classList.add('bg-green-500');
                showVideoSection();
                showControlButtons();
                hideStartButton();
                hideInfoForm();
                updateVideoOverlay();
                updateButtonText(true);
            } else if (status === 'connecting') {
                statusIndicator.classList.add('bg-yellow-500');
                hideVideoSection();
                hideControlButtons();
                showStartButton();
                showInfoForm();
                updateButtonText(false);
            } else {
                statusIndicator.classList.add('bg-gray-400');
                hideVideoSection();
                hideControlButtons();
                showStartButton();
                showInfoForm();
                updateButtonText(false);
            }
        }

        // Show error message
        function showError(message) {
            const errorText = errorMessageEl.querySelector('p');
            errorText.textContent = message;
            errorMessageEl.classList.remove('hidden');
            setTimeout(() => {
                errorMessageEl.classList.add('hidden');
            }, 5000);
        }

        // Generate unique client ID
        function generateClientId() {
            return 'client_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Populate channel dropdown
        function populateChannels() {
            for (let i = 1; i <= 20; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Channel ${i}`;
                channelSelect.appendChild(option);
            }
        }

        // Validate form
        function validateForm() {
            userName = userNameInput.value.trim();
            channelNumber = channelSelect.value;
            
            if (!userName) {
                showError('Please enter your name');
                return false;
            }
            
            if (!channelNumber) {
                showError('Please select a channel');
                return false;
            }
            
            return true;
        }

        // Setup audio monitoring
        function setupAudioMonitoring() {
            if (!localStream) return;

            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(localStream);
                source.connect(analyser);

                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);

                function updateAudioLevel() {
                    analyser.getByteFrequencyData(dataArray);
                    
                    // Calculate average frequency data
                    let sum = 0;
                    for (let i = 0; i < bufferLength; i++) {
                        sum += dataArray[i];
                    }
                    const average = sum / bufferLength;
                    const percentage = Math.min((average / 255) * 100, 100);
                    
                    // Update visualizer
                    audioLevelEl.style.width = percentage + '%';
                    
                    animationId = requestAnimationFrame(updateAudioLevel);
                }

                updateAudioLevel();
            } catch (error) {
                console.error('Error setting up audio monitoring:', error);
            }
        }

        // Stop audio monitoring
        function stopAudioMonitoring() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            audioLevelEl.style.width = '0%';
        }

        // Start camera and WebRTC connection
        async function start() {
            try {
                // Validate form first
                if (!validateForm()) {
                    return;
                }
                
                updateStatus('connecting', 'Requesting camera access...');
                startBtn.disabled = true;
                errorMessageEl.classList.add('hidden');

                // Generate client ID
                clientId = generateClientId();
                console.log('Client ID:', clientId);
                
                // Update overlay with current form values
                updateVideoOverlay();
                
                // Save preferences before connecting
                saveUserPreferences();

                // Request media access
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                });

                // Display local video
                localVideoEl.srcObject = localStream;

                // Setup audio monitoring
                setupAudioMonitoring();

                updateStatus('connecting', 'Connecting to server...');

                // Create peer connection
                pc = new RTCPeerConnection({
                    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
                });

                // Add local tracks and store audio track reference
                localStream.getTracks().forEach(track => {
                    console.log(`Adding ${track.kind} track:`, track);
                    pc.addTrack(track, localStream);
                    
                    // Store audio track for mute functionality
                    if (track.kind === 'audio') {
                        audioTrack = track;
                    }
                });

                // Handle ICE candidates
                pc.onicecandidate = (event) => {
                    if (event.candidate) {
                        console.log('ICE candidate:', event.candidate);
                    }
                };

                // Handle track events
                pc.ontrack = (event) => {
                    console.log('Remote track received:', event.track.kind);
                };

                // Handle connection state changes
                pc.onconnectionstatechange = () => {
                    console.log('Connection state:', pc.connectionState);
                    if (pc.connectionState === 'connected') {
                        updateStatus('connected', 'Connected - Streaming to server');
                        
                        // Restore mute state after connection
                        if (audioTrack) {
                            audioTrack.enabled = !isMuted;
                            updateMuteButton();
                        }
                    } else if (pc.connectionState === 'failed' || pc.connectionState === 'disconnected') {
                        updateStatus('disconnected', 'Connection lost');
                        startBtn.disabled = false;
                    }
                };

                // Create offer
                const offer = await pc.createOffer();
                await pc.setLocalDescription(offer);

                // Send offer to server
                const response = await fetch('/offer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sdp: offer.sdp,
                        type: offer.type,
                        clientId: clientId,
                        userName: userName,
                        channel: parseInt(channelNumber)
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const answer = await response.json();
                await pc.setRemoteDescription(new RTCSessionDescription(answer));

                console.log('WebRTC connection established');

            } catch (error) {
                console.error('Error starting camera:', error);
                
                let errorMessage = 'Failed to start camera. ';
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Please allow camera and microphone access.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'No camera or microphone found.';
                } else if (error.name === 'NotReadableError') {
                    errorMessage += 'Camera or microphone is already in use.';
                } else {
                    errorMessage += error.message;
                }
                
                showError(errorMessage);
                updateStatus('disconnected', 'Failed to connect');
                startBtn.disabled = false;
                
                // Cleanup on error
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = null;
                }
                stopAudioMonitoring();
            }
        }

        // Save user preferences to localStorage
        function saveUserPreferences() {
            const preferences = {
                isMuted: isMuted,
                userName: userNameInput.value.trim(),
                channelNumber: channelSelect.value,
                timestamp: Date.now()
            };
            localStorage.setItem('conferencePreferences', JSON.stringify(preferences));
            console.log('User preferences saved:', preferences);
            
            // Show save indicator briefly
            const saveIndicator = document.getElementById('saveIndicator');
            saveIndicator.classList.remove('hidden');
            setTimeout(() => {
                saveIndicator.classList.add('hidden');
            }, 1500);
        }

        // Load user preferences from localStorage
        function loadUserPreferences() {
            try {
                const saved = localStorage.getItem('conferencePreferences');
                if (saved) {
                    const data = JSON.parse(saved);
                    // Only restore if saved within last 7 days
                    if (Date.now() - data.timestamp < 7 * 24 * 60 * 60 * 1000) {
                        isMuted = data.isMuted || false;
                        if (data.userName) {
                            userNameInput.value = data.userName;
                        }
                        if (data.channelNumber) {
                            channelSelect.value = data.channelNumber;
                        }
                        return true;
                    }
                }
            } catch (error) {
                console.error('Error loading user preferences:', error);
            }
            return false;
        }

        // Save mute state to localStorage (legacy function for backward compatibility)
        function saveMuteState() {
            saveUserPreferences();
        }

        // Load mute state from localStorage (legacy function for backward compatibility)
        function loadMuteState() {
            return loadUserPreferences();
        }

        // Clear saved preferences (for testing or reset)
        function clearUserPreferences() {
            localStorage.removeItem('conferencePreferences');
            localStorage.removeItem('conferenceMuteState'); // Clear legacy data too
            isMuted = false;
            userNameInput.value = '';
            channelSelect.value = '';
            updateMuteButton();
            console.log('User preferences cleared');
        }

        // Update mute button appearance
        function updateMuteButton() {
            if (isMuted) {
                muteBtn.className = 'absolute bottom-4 left-4 w-12 h-12 bg-red-500/80 hover:bg-red-600/80 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110';
                muteBtn.innerHTML = '<span class="text-xl">üîá</span>';
            } else {
                muteBtn.className = 'absolute bottom-4 left-4 w-12 h-12 bg-black/50 hover:bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110';
                muteBtn.innerHTML = '<span class="text-xl">üîä</span>';
            }
        }

        // Mute/unmute audio
        function toggleMute() {
            try {
                if (!audioTrack) {
                    console.error('No audio track available');
                    return;
                }
                
                isMuted = !isMuted;
                audioTrack.enabled = !isMuted;
                
                // Update button appearance
                updateMuteButton();
                
                // Save state
                saveMuteState();
                
                console.log(isMuted ? 'Audio muted' : 'Audio unmuted');
                
            } catch (error) {
                console.error('Error toggling mute:', error);
                showError('Error toggling mute: ' + error.message);
            }
        }

        // Stop camera and WebRTC connection
        function stop() {
            try {
                updateStatus('disconnected', 'Stopping...');
                
                // Stop audio monitoring
                stopAudioMonitoring();
                
                // Stop local stream
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = null;
                }
                
                // Close peer connection
                if (pc) {
                    pc.close();
                    pc = null;
                }
                
                // Clear video
                localVideoEl.srcObject = null;
                
                // Reset UI
                updateStatus('disconnected', 'Disconnected - Click Join to begin');
                startBtn.disabled = false;
                audioLevelEl.style.width = '0%';
                
                // Reset audio track but keep mute state
                audioTrack = null;
                // Don't reset isMuted - keep the user's preference
                updateMuteButton();
                
                console.log('Camera stopped');
                
            } catch (error) {
                console.error('Error stopping camera:', error);
                showError('Error stopping camera: ' + error.message);
            }
        }

        // Event listeners
        startBtn.addEventListener('click', start);
        muteBtn.addEventListener('click', toggleMute);
        stopBtn.addEventListener('click', stop);
        
        // Save preferences when form fields change
        userNameInput.addEventListener('input', () => {
            saveUserPreferences();
            updateVideoOverlay();
        });
        channelSelect.addEventListener('change', () => {
            saveUserPreferences();
            updateVideoOverlay();
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && pc && pc.connectionState === 'connected') {
                console.log('Page hidden, maintaining connection');
            } else if (!document.hidden && pc && pc.connectionState === 'connected') {
                console.log('Page visible, connection active');
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', () => {
            // Save current preferences before leaving
            saveUserPreferences();
            
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            if (pc) {
                pc.close();
            }
        });

        // Handle page visibility changes (mobile app switching)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Save preferences when page becomes hidden
                saveUserPreferences();
            }
        });


        // Function to check server status
        async function checkStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();
                console.log('Server status:', data);
                
                // Update audio level display with server data
                if (data.audio_levels && Object.keys(data.audio_levels).length > 0) {
                    const maxLevel = Math.max(...Object.values(data.audio_levels));
                    const percentage = Math.min((maxLevel / 1000) * 100, 100);
                    audioLevelEl.style.width = percentage + '%';
                }
            } catch (error) {
                console.error('Error checking status:', error);
            }
        }

        // Check status every 2 seconds when connected
        setInterval(() => {
            if (pc && pc.connectionState === 'connected') {
                checkStatus();
            }
        }, 2000);

        // Initialize
        console.log('Conference Camera Client initialized');
        populateChannels();
        
        // Load saved preferences
        const preferencesRestored = loadUserPreferences();
        updateMuteButton();
        
        if (preferencesRestored) {
            console.log('User preferences restored from previous session');
            // Show indicator briefly
            const indicator = document.getElementById('muteStateIndicator');
            indicator.querySelector('span:last-child').textContent = 'Preferences restored from previous session';
            indicator.classList.remove('hidden');
            setTimeout(() => {
                indicator.classList.add('hidden');
            }, 3000);
        }
        
        // Initialize layout
        hideVideoSection();
        hideControlButtons();
        showStartButton();
        showInfoForm();
        updateVideoOverlay();
        updateStatus('disconnected', 'Disconnected - Click Join to begin');
    </script>
</body>
</html>